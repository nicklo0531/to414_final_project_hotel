"0","library(dplyr)"
"0","library(caret)"
"0",""
"0","# Best model row"
"0",""
"0","best_row <- best_by_cost %>% slice_min(AvgCost, with_ties = FALSE)"
"0",""
"0","best_model_name <- best_row$Model"
"0","best_threshold  <- best_row$Threshold"
"0",""
"0","cat(""Best model:"", best_model_name, ""\n"")"
"1","Best model:"
"1"," "
"1","Random Forest"
"1"," "
"1","
"
"0","cat(""Threshold used:"", best_threshold, ""\n\n"")"
"1","Threshold used:"
"1"," "
"1","0.57"
"1"," "
"1","

"
"0","# Get predicted probabilities"
"0",""
"0","pred_probs <- switch("
"0","best_model_name,"
"0","""Logistic""             = log_test_prob,"
"0","""ANN""                  = ann_test_prob,"
"0","""KNN""                  = knn_test_prob,"
"0","""Decision Tree""        = dt_test_prob,"
"0","""Random Forest""        = rf_test_prob,"
"0","""SVM (linear)""         = svm_test_prob,"
"0","""Stacked (meta-logit)"" = stack_test_prob"
"0",")"
"0",""
"0","# Convert probabilities to factor predictions"
"0",""
"0","if (is.na(best_threshold)) {"
"0","pred_classes <- factor(ifelse(pred_probs >= 0.5, 1, 0), levels = c(0,1))"
"0","} else {"
"0","pred_classes <- factor(ifelse(pred_probs >= best_threshold, 1, 0), levels = c(0,1))"
"0","}"
"0",""
"0","# Ensure reference is factor with same levels"
"0",""
"0","y_test_factor <- factor(y_test, levels = c(0,1))"
"0",""
"0","# Compute confusion matrix"
"0",""
"0","best_cm <- confusionMatrix(pred_classes, y_test_factor, positive=""1"")"
"0","best_cm"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","    0"
"1","    1"
"1","
         0"
"1"," 1052"
"1","  312"
"1","
         1"
"1","   52"
"1","  524"
"1","
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.8124          "
"1","
"
"1","                 95% CI :"
"1"," (0.7943, 0.8295)"
"1","
"
"1","    No Information Rate :"
"1"," 0.5691          "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," < 2.2e-16       "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," 0.6024          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," < 2.2e-16       "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","            Sensitivity :"
"1"," 0.6268          "
"1","
"
"1","            Specificity :"
"1"," 0.9529          "
"1","
"
"1","         Pos Pred Value :"
"1"," 0.9097          "
"1","
"
"1","         Neg Pred Value :"
"1"," 0.7713          "
"1","
"
"1","             Prevalence :"
"1"," 0.4309          "
"1","
"
"1","         Detection Rate :"
"1"," 0.2701          "
"1","
"
"1","   Detection Prevalence :"
"1"," 0.2969          "
"1","
"
"1","      Balanced Accuracy :"
"1"," 0.7898          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","       'Positive' Class :"
"1"," 1               "
"1","
"
"1","                         "
"1","                 "
"1","
"

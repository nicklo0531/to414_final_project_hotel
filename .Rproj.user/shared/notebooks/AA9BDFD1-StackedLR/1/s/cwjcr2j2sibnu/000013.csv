"0","# Threshold that maximizes precision in the original LR (this should give 0 FPs)"
"0","orig_thresh_no_fp <- metric_plot_df$Threshold[metric_plot_df$Metric == ""Precision""]"
"0",""
"0","orig_preds <- ifelse(log_test_prob >= orig_thresh_no_fp, 1, 0)"
"0",""
"0","orig_cm <- confusionMatrix("
"0","  factor(orig_preds, levels = c(0, 1)),"
"0","  factor(y_test,     levels = c(0, 1)),"
"0","  positive = ""1"""
"0",")"
"0",""
"0","orig_FP <- sum(orig_preds == 1 & y_test == 0)"
"0","orig_FN <- sum(orig_preds == 0 & y_test == 1)"
"0","orig_cost <- C_FP * orig_FP + C_FN * orig_FN"
"0","orig_avg_cost <- orig_cost / length(y_test)"
"0",""
"0","original_lr_row <- data.frame("
"0","  Threshold   = orig_thresh_no_fp,"
"0","  Accuracy    = orig_cm$overall[""Accuracy""],"
"0","  Kappa       = orig_cm$overall[""Kappa""],"
"0","  Sensitivity = orig_cm$byClass[""Sensitivity""],"
"0","  Precision   = orig_cm$byClass[""Pos Pred Value""],"
"0","  Cost        = orig_cost,"
"0","  AvgCost     = orig_avg_cost,"
"0","  Model       = ""Logistic (No False Positives)"""
"0",")"
"0",""
"0","## 4b. Super simple baseline that never predicts a cancellation"
"0","##     This basically says “everyone will show up”"
"0",""
"0","baseline_preds <- rep(0, length(y_test))"
"0",""
"0","baseline_cm <- confusionMatrix("
"0","  factor(baseline_preds, levels = c(0, 1)),"
"0","  factor(y_test,          levels = c(0, 1)),"
"0","  positive = ""1"""
"0",")"
"0",""
"0","baseline_FP <- 0"
"0","baseline_FN <- sum(y_test == 1)"
"0","baseline_cost <- C_FP * baseline_FP + C_FN * baseline_FN"
"0","baseline_avg_cost <- baseline_cost / length(y_test)"
"0","baseline_cancel_rate <- mean(y_test)  # percent of cancels in the original test split"
"0",""
"0","baseline_row <- data.frame("
"0","  Threshold   = NA_real_,"
"0","  Accuracy    = baseline_cm$overall[""Accuracy""],"
"0","  Kappa       = baseline_cm$overall[""Kappa""],"
"0","  Sensitivity = baseline_cm$byClass[""Sensitivity""],"
"0","  Precision   = baseline_cm$byClass[""Pos Pred Value""],"
"0","  Cost        = baseline_cost,"
"0","  AvgCost     = baseline_avg_cost,"
"0","  Model       = ""Baseline (No Model)"""
"0",")"
"0",""
"0","## Combine everything and then get “best by cost” including the two new baselines"
"0",""
"0","results_all_full <- bind_rows(results_all, original_lr_row, baseline_row)"
"0",""
"0","best_by_cost <- results_all_full %>%"
"0","  group_by(Model) %>%"
"0","  slice_min(AvgCost, with_ties = FALSE) %>%"
"0","  ungroup()"
"0",""
"0","print(best_by_cost)"
